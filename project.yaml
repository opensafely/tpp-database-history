version: "3.0"

expectations:
  population_size: 1000

actions:
  query:
    run: >
      sqlrunner:latest
        --dummy-data-file output/generate_dummy_rows/dummy_rows.csv.gz
        --output output/query/rows.csv.gz
        analysis/query.sql
    outputs:
      highly_sensitive:
        rows: output/query/rows.csv.gz

  aggregate:
    needs: [query]
    run: python:latest python -m analysis.aggregate
    outputs:
      moderately_sensitive:
        aggregates: output/aggregate/*_by_*.csv.gz

  plot:
    needs: [aggregate]
    run: >
      python:latest python -m analysis.plot
        --from-date 2016-01-01
        --output output/plot
    outputs:
      moderately_sensitive:
        plots: output/plot/*.png

  render_report:
    needs: [plot]
    run: python:latest python -m analysis.render_report
    outputs:
      moderately_sensitive:
        report: output/render_report/report.html
